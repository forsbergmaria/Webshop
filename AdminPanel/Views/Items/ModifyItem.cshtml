@using Models
@model ItemViewModel

<body>
    <h2>Uppdatera produkt</h2>
    <form method="post" asp-controller="Items" asp-action="ModifyItem" enctype="multipart/form-data">
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="form-group">
            @Html.LabelFor(m => m.Name, new { @class = "col-md-2 control-label" })
            @Html.TextBoxFor(m => m.Name, new { @class = "form-control" })
            @Html.ValidationMessageFor(m => m.Name, "", new { @class = "text-danger" })
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.Brand, new { @class = "col-md-2 control-label" })
            @Html.TextBoxFor(m => m.Brand, new { @class = "form-control" })
            @Html.ValidationMessageFor(m => m.Brand, "", new { @class = "text-danger" })
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.Description, new { @class = "col-md-2 control-label" })
            @Html.TextAreaFor(m => m.Description, new { @class = "form-control" })
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.Color, new { @class = "col-md-2 control-label" })
            @Html.TextBoxFor(m => m.Color, new { @class = "form-control" })
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.ArticleNr, new { @class = "col-md-2 control-label" })
            @Html.TextBoxFor(m => m.ArticleNr, new { @class = "form-control" })
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.PriceWithoutVAT, new { @class = "col-md-2 control-label" })
            @Html.TextBoxFor(m => m.PriceWithoutVAT, new { @class = "form-control" })
            @Html.ValidationMessageFor(m => m.PriceWithoutVAT, "", new { @class = "text-danger" })
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.VAT, new { @class = "col-md-2 control-label" })
            @Html.TextBoxFor(m => m.VAT, new { @class = "form-control" })
            @Html.ValidationMessageFor(m => m.VAT, "", new { @class = "text-danger" })
        </div>
        <div class="form-check>
            @Html.LabelFor(m => m.HasSize, new { @class = "col-md-2 control-label" })
            @Html.CheckBoxFor(m => m.HasSize, new { @class = "form-check-input" })
        </div>
        <div class="form-group">
    @Html.LabelFor(m => m.Category, "Välj kategori:", htmlAttributes: new { @class = "control-label col-md-2" })
    <div class="col-md-10">
                @Html.DropDownListFor(m => m.Category, new SelectList(ViewBag.Categories, "CategoryId", "Name"), "Välj kategori", htmlAttributes: new { @class = "form-control", id = "categoryDropdown" })
    </div>
            @Html.ValidationMessageFor(m => m.Category, "", new { @class = "text-danger" })
            <div class="input-group-append">
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#newCategoryModal">
                    Skapa en ny kategori
                </button>
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.Subcategory, "Välj underkategori:", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.DropDownListFor(m => m.Subcategory, new SelectList(Enumerable.Empty<SelectListItem>(), "Value", "Text"), "Välj en underkategori", new { @class = "form-control", id = "subcategoryDropdown" })
            </div>
            <div class="input-group-append">
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#newCategoryModal">
                    Skapa en ny kategori
                </button>
            </div>
        </div>
        @foreach (var image in Model.ProductImages.DistinctBy(p => p.Path))
        {
                <img src="@Url.Content(image.Path)" />
                <a asp-controller="" asp-action="">Ta bort bild</a>
        }
        <div class="form-group">
            @Html.LabelFor(m => m.ProductImages, new { @class = "col-md-2 control-label" })
            <input asp-for="ProductImages" type="file" name="files" multiple class="form-control-file" accept="image/jpeg, image/png, image/jpg" />
        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Uppdatera produkt" class="btn btn-primary" id="btn-updateItem-submit" />
            </div>
        </div>
    </form>
</body>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

@*@section Scripts{
    <script>
        $(document).ready(function () {
            // Händelselyssnare för kategoridropdown
            $('#categoryDropdown').on('change', function () {
                var categoryId = $(this).val(); // Hämta vald kategoriid

                // Anropa GetSubcategories-metoden i ItemsController med AJAX
                $.ajax({
                    url: '/Items/GetSubcategories',
                    type: 'GET',
                    dataType: 'json',
                    data: { categoryId: categoryId }, // Skicka categoryId som data
                    success: function (data) {
                        // Rensa och fyll på underkategoridropdown med nya värden
                        $('#subCategoryDropdown').empty();
                        $.each(data, function (index, subcategory) {
                            $('#subCategoryDropdown').append($('<option/>', {
                                value: subcategory.SubcategoryId,
                                text: subcategory.Name
                            }));
                        });
                    },
                    error: function () {
                        console.log('Ett fel uppstod vid hämtning av underkategorier.');
                    }
                });
            });
        });
    </script>
}*@